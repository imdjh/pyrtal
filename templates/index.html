{% extends "base.html" %}
{% block title %}首页{% endblock %}
{% block banner %}
{% include "logowords.html" %}
{% endblock %}

{% block functional_area %}
<div class="am-vertical-align" id="pyrtal-interface">
    <div class="am-vertical-align-middle">
            <div class="am-g-collapse">
                <form class="am-form" role="form" action="/portal">
                    <div class="am-u-sm-1" style="height: 10px;"></div>
                    <div class="am-u-sm-8">
                        <div class="am-form-group am-form-icon
                                am-form-group-md " id="functional-area">
                            <i class="am-icon-link am-icon-fw"></i>
                            <input id="uri" type="text" class="am-form-field am-input-md" placeholder="请正确的输入URL" name="pyrtal-request">
                        </div>
                    </div>
                    <div class="am-u-sm-2">
                        <span id="submit-btm" type="submit"
                                class="am-btn am-btn-primary
                                am-btn-lg"><i
                                class="am-icon-download"></i> 提 交
                        </span>
                    </div>
                </form>
            </div>
    </div>
</div>
{% endblock %}
{% block add_js %}
<script>
$(document).ready(function() {
    var header_height = $('#collapse-head').height();
    var footer_height = $('#footer-fixed').height();
    var content_height = $(window).height() - header_height - footer_height;
    var content_width = $(window).width();
    //高度修正
    $('.am-vertical-align-middle').css('width', '100%');
    $('.am-vertical-align').css('height', '100%');

    //宣传语自适应
    if (content_height < 400 || $(window).width() < 400) {
        $('.autoajust-text').css('font-size', '120%');
    }

    //高度自适应
    if (content_height < 400) {
        $('#autoajust-logo').css('display', 'none');
        $('#banner').css('height', content_height * .50);
    } else {
        $('#autoajust-logo').css('width', '75%');
        var correct_height = $('#autoajust-logo').innerWidth();
        $('#autoajust-logo').css('height', correct_height / 10 * 3);
        $('#banner').css('height', content_height * .70);
    }
    $('.am-topbar-right').css('height', header_height);
    $('#pyrtal-interface').css('height', content_height * .20);

});

$(window).resize(function() {
    //获取新数值
    var header_height = $('#collapse-head').height();
    var footer_height = $('#footer-fixed').height();
    var content_height = $(window).height() - header_height - footer_height;
    var content_width = $(window).width();

    //宣传语自适应
    if (content_height < 400 || $(window).width() < 400) {
        $('.autoajust-text').css('font-size', '120%');
    } else {
        $('.autoajust-text').removeAttr('style');
    }

    //高度自适应
    if (content_height < 400) {
        $('#autoajust-logo').css('display', 'none');
        $('#banner').css('height', content_height * .50);
    } else {
        $('#autoajust-logo').css('display', 'block');
        $('#autoajust-logo').css('width', '75%');
        var correct_height = $('#autoajust-logo').innerWidth();
        $('#autoajust-logo').css('height', correct_height / 10 * 3);
        $('#banner').css('height', content_height * .70);
    }
    $('.am-topbar-right').css('height', header_height);
    $('#pyrtal-interface').css('height', content_height * .20);
});
</script>

<script src="{{ url_for('static', filename='assets/js/uri.js') }}"></script>
<script type="text/javascript">
$('#uri').blur(function () {
        res = URI.parse($('#uri').val());
        if (res["reference"] != "absolute") {
                var temp = res["path"];
                var slash_spliter = temp.indexOf('/');
                res["host"] = temp.substr(0, slash_spliter);
                res["path"] = temp.substr(slash_spliter, temp.length);
        }
        if (res["scheme"] == null) {
                res["scheme"] = 'http';
        }

        if ("" === res["host"] || res["errors"].length != 0)
            {
                $('#functional-area').addClass('am-form-error');
        } else {
                $('#functional-area').removeClass('am-form-error');
                if (!Number(res['port'])) {
                        res['port'] = "80";
                }

        // DEBUG: HARD
        alert(JSON.stringify(res));
        post_json();
        }
});
function post_json() {
        $.ajax({
                type: "POST",
        url: "/",
        data: JSON.stringify(res),
        contentType: "application/json",
        dataType: "json",
        success: function(data) {alert(data);}

        });
}






</script>
{% endblock %}
